<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.43">

  <title>Data Engineering Guides ‚Äì ‚õèÔ∏è Data Mining with PostgreSQL</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-d58ca6e55452da357bd4996cb6e3aa10.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">‚õèÔ∏è Data Mining with PostgreSQL</h1>

<div class="quarto-title-authors">
</div>

</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/psql-guide" id="/toc-psql-guide">üìä PSQL Guide</a></li>
<li><a href="#/prerequisites" id="/toc-prerequisites">üî≠ Prerequisites</a></li>
<li><a href="#/verifying-you-can-run-the-psql-command" id="/toc-verifying-you-can-run-the-psql-command">üîç Verifying You Can Run the <code>psql</code> Command</a></li>
<li><a href="#/get-the-railway-postgres-connection-url" id="/toc-get-the-railway-postgres-connection-url">üåê Get the Railway Postgres Connection URL</a></li>
<li><a href="#/copying-csv-file-using-psql" id="/toc-copying-csv-file-using-psql">üì¶ Copying CSV File Using <code>psql</code></a></li>
<li><a href="#/tips-and-troubleshooting" id="/toc-tips-and-troubleshooting">üíÅüèΩ Tips and Troubleshooting</a></li>
<li><a href="#/verify" id="/toc-verify">üëÄ Verify</a></li>
<li><a href="#/outline" id="/toc-outline">Outline</a></li>
<li><a href="#/what-is-query-performance" id="/toc-what-is-query-performance">What is Query Performance?</a></li>
<li><a href="#/benchmarking-queries" id="/toc-benchmarking-queries">Benchmarking Queries</a></li>
<li><a href="#/pagila-database" id="/toc-pagila-database">Pagila Database</a></li>
<li><a href="#/indexing-in-postgresql" id="/toc-indexing-in-postgresql">Indexing in PostgreSQL</a></li>
<li><a href="#/visualizing-the-query-plan" id="/toc-visualizing-the-query-plan">Visualizing the Query Plan</a></li>
<li><a href="#/when-indexes-help" id="/toc-when-indexes-help">When Indexes Help</a></li>
<li><a href="#/when-indexes-hurt" id="/toc-when-indexes-hurt">When Indexes Hurt</a></li>
<li><a href="#/bonus-composite-indexes" id="/toc-bonus-composite-indexes">Bonus: Composite Indexes</a></li>
<li><a href="#/hands-on-challenge" id="/toc-hands-on-challenge">Hands-On Challenge</a></li>
<li><a href="#/summary-1" id="/toc-summary-1">Summary</a></li>
<li><a href="#/questions" id="/toc-questions">Questions?</a></li>
<li><a href="#/introduction-to-data-mining-with-postgres" id="/toc-introduction-to-data-mining-with-postgres">Introduction to Data Mining with Postgres</a></li>
<li><a href="#/find-all-customers-whose-last-name-starts-with-mc" id="/toc-find-all-customers-whose-last-name-starts-with-mc">Find all customers whose last name starts with ‚ÄòMc‚Äô</a></li>
<li><a href="#/find-film-titles-that-include-the-word-love-case-insensitive" id="/toc-find-film-titles-that-include-the-word-love-case-insensitive">Find film titles that include the word ‚Äòlove‚Äô (case-insensitive)</a></li>
<li><a href="#/using-regex-to-classify-films" id="/toc-using-regex-to-classify-films">Using Regex to Classify Films</a></li>
<li><a href="#/extracting-words-regex-functions" id="/toc-extracting-words-regex-functions">Extracting Words: Regex Functions</a></li>
<li><a href="#/example-extract-the-first-word-from-film-titles" id="/toc-example-extract-the-first-word-from-film-titles">Example: Extract the first word from film titles</a></li>
<li><a href="#/regex-replace-clean-up-phone-numbers" id="/toc-regex-replace-clean-up-phone-numbers">Regex Replace: Clean Up Phone Numbers</a></li>
<li><a href="#/advanced-query-categorize-titles-by-pattern" id="/toc-advanced-query-categorize-titles-by-pattern">Advanced Query: Categorize Titles by Pattern</a></li>
<li><a href="#/use-regex-in-joins" id="/toc-use-regex-in-joins">Use Regex in Joins</a></li>
<li><a href="#/practice-challenge" id="/toc-practice-challenge">Practice Challenge</a></li>
<li><a href="#/tips-and-tricks" id="/toc-tips-and-tricks">Tips and Tricks</a></li>
<li><a href="#/resources" id="/toc-resources">Resources</a></li>
<li><a href="#/questions-1" id="/toc-questions-1">Questions?</a></li>
</ul>
</nav>
</section>
<section>
<section id="psql-guide" class="title-slide slide level1 center">
<h1>üìä PSQL Guide</h1>
<p>Lucas Cordova</p>
</section>
<section class="slide level2">

</section>
<section id="dataset-used" class="slide level2">
<h2>Dataset Used</h2>
<p>For this lecture, we use the <strong>Pagila</strong> database ‚Äî a PostgreSQL-compatible version of the classic Sakila DVD rental database.</p>
<p>Download the SQL file from <a href="https://willamette.instructure.com/courses/7432/pages/week-13">Canvas</a> to follow along.</p>
<p>To load it into Postgres: 1. Create a new database called pagila_dvd. 2. Execute the contents of the SQL file you downloaded.</p>
</section>
<section id="learning-objectives" class="slide level2">
<h2>Learning Objectives</h2>
<ul>
<li>Understand and create <strong>Views</strong> in PostgreSQL</li>
<li>Understand and create <strong>User-Defined Functions</strong></li>
<li>Understand and create <strong>Stored Procedures</strong></li>
<li>Understand and create <strong>Triggers</strong></li>
<li>See practical examples using the <strong>Pagila</strong> dataset</li>
</ul>
</section>
<section id="views-in-postgresql" class="slide level2">
<h2>Views in PostgreSQL</h2>
<p>A <strong>View</strong> is a stored query that you can treat like a table.</p>
<h3 id="why-use-views">Why Use Views?</h3>
<ul>
<li>Simplify complex queries</li>
<li>Reuse SQL logic</li>
<li>Add a security layer</li>
<li>Encapsulate business logic</li>
</ul>
</section>
<section id="creating-a-simple-view" class="slide level2">
<h2>Creating a Simple View</h2>
<h3 id="example-top-5-most-rented-films">Example: Top 5 Most Rented Films</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb1-1"><a></a><span class="kw">CREATE</span> <span class="kw">VIEW</span> top_5_rented_films <span class="kw">AS</span></span>
<span id="cb1-2"><a></a><span class="kw">SELECT</span> f.title, <span class="fu">COUNT</span>(r.rental_id) <span class="kw">AS</span> rental_count</span>
<span id="cb1-3"><a></a><span class="kw">FROM</span> film f</span>
<span id="cb1-4"><a></a><span class="kw">JOIN</span> inventory i <span class="kw">ON</span> f.film_id <span class="op">=</span> i.film_id</span>
<span id="cb1-5"><a></a><span class="kw">JOIN</span> rental r <span class="kw">ON</span> i.inventory_id <span class="op">=</span> r.inventory_id</span>
<span id="cb1-6"><a></a><span class="kw">GROUP</span> <span class="kw">BY</span> f.title</span>
<span id="cb1-7"><a></a><span class="kw">ORDER</span> <span class="kw">BY</span> rental_count <span class="kw">DESC</span></span>
<span id="cb1-8"><a></a><span class="kw">LIMIT</span> <span class="dv">5</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can now query it like a table:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb2-1"><a></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> top_5_rented_films;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="updatable-views" class="slide level2">
<h2>Updatable Views</h2>
<p>Views are read-only <strong>unless</strong>:</p>
<ul>
<li>Based on a single table</li>
<li>No aggregates or GROUP BY</li>
<li>No DISTINCT, LIMIT, OFFSET, JOIN</li>
</ul>
<p>You can make them updatable with <strong>INSTEAD OF triggers</strong>.</p>
</section>
<section id="functions-in-postgresql" class="slide level2">
<h2>Functions in PostgreSQL</h2>
<p>User-defined functions (UDFs) allow you to write <strong>reusable logic</strong>. They can return:</p>
<ul>
<li>Scalar values</li>
<li>Table results (set-returning functions)</li>
</ul>
<p>Written in SQL or PL/pgSQL (PostgreSQL‚Äôs procedural language).</p>
<h3 id="example-scalar-function">Example: Scalar Function</h3>
<p>Return number of films an actor has appeared in:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a></a><span class="kw">CREATE</span> <span class="kw">FUNCTION</span> film_count(actor_id <span class="dt">INT</span>) RETURNS <span class="dt">INT</span> <span class="kw">AS</span> $$</span>
<span id="cb3-2"><a></a>  <span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>)</span>
<span id="cb3-3"><a></a>  <span class="kw">FROM</span> film_actor</span>
<span id="cb3-4"><a></a>  <span class="kw">WHERE</span> film_actor.actor_id <span class="op">=</span> $<span class="dv">1</span>;</span>
<span id="cb3-5"><a></a>$$ LANGUAGE SQL;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Usage:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a></a><span class="kw">SELECT</span> film_count(<span class="dv">1</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<h3 id="example-table-function">Example: Table Function</h3>
<p>List all films rented by a customer:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">FUNCTION</span> customer_rentals(cust_id <span class="dt">INT</span>)</span>
<span id="cb5-2"><a></a>RETURNS <span class="kw">TABLE</span>(title TEXT, rental_date <span class="dt">TIMESTAMP</span>) <span class="kw">AS</span> $$</span>
<span id="cb5-3"><a></a><span class="cf">BEGIN</span></span>
<span id="cb5-4"><a></a>  <span class="kw">RETURN</span> <span class="kw">QUERY</span></span>
<span id="cb5-5"><a></a>  <span class="kw">SELECT</span> f.title, r.rental_date:<span class="ch">:TIMESTAMP</span></span>
<span id="cb5-6"><a></a>  <span class="kw">FROM</span> rental r</span>
<span id="cb5-7"><a></a>  <span class="kw">JOIN</span> inventory i <span class="kw">ON</span> r.inventory_id <span class="op">=</span> i.inventory_id</span>
<span id="cb5-8"><a></a>  <span class="kw">JOIN</span> film f <span class="kw">ON</span> i.film_id <span class="op">=</span> f.film_id</span>
<span id="cb5-9"><a></a>  <span class="kw">WHERE</span> r.customer_id <span class="op">=</span> cust_id;</span>
<span id="cb5-10"><a></a><span class="cf">END</span>;</span>
<span id="cb5-11"><a></a>$$ LANGUAGE plpgsql</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Usage:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb6-1"><a></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> customer_rentals(<span class="dv">1</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="stored-procedures" class="slide level2">
<h2>Stored Procedures</h2>
<p>Procedures are like functions but:</p>
<ul>
<li>Do not return values</li>
<li>Support <strong>transactions</strong> (e.g., COMMIT/ROLLBACK)</li>
</ul>
<p>Useful for batch operations, data migrations, etc.</p>
<h3 id="example-stored-procedure">Example: Stored Procedure</h3>
<p>Let‚Äôs use a Stored Procedure to store deleted customers.</p>
<p>First, let‚Äôs create a customer_deletion_log table.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb7-1"><a></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> customer_deletion_log (</span>
<span id="cb7-2"><a></a>    customer_id SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb7-3"><a></a>    deleted_at <span class="dt">TIMESTAMP</span> <span class="kw">default</span> NOW()</span>
<span id="cb7-4"><a></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<h3 id="example-stored-procedure-1">Example: Stored Procedure</h3>
<p>Now, let‚Äôs create a Stored Procedure to delete a customer and log the deletion:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb8-1"><a></a><span class="kw">CREATE</span> <span class="kw">PROCEDURE</span> delete_customer(cust_id <span class="dt">INT</span>)</span>
<span id="cb8-2"><a></a>LANGUAGE plpgsql</span>
<span id="cb8-3"><a></a><span class="kw">AS</span> $$</span>
<span id="cb8-4"><a></a><span class="cf">BEGIN</span></span>
<span id="cb8-5"><a></a>  <span class="kw">DELETE</span> <span class="kw">FROM</span> payment <span class="kw">WHERE</span> customer_id <span class="op">=</span> cust_id;</span>
<span id="cb8-6"><a></a>  <span class="kw">DELETE</span> <span class="kw">FROM</span> rental <span class="kw">WHERE</span> customer_id <span class="op">=</span> cust_id;</span>
<span id="cb8-7"><a></a>  <span class="kw">DELETE</span> <span class="kw">FROM</span> customer <span class="kw">WHERE</span> customer_id <span class="op">=</span> cust_id;</span>
<span id="cb8-8"><a></a>  <span class="kw">INSERT</span> <span class="kw">INTO</span> customer_deletion_log(customer_id, deleted_at)</span>
<span id="cb8-9"><a></a>  <span class="kw">VALUES</span> (cust_id, NOW());</span>
<span id="cb8-10"><a></a><span class="cf">END</span>;</span>
<span id="cb8-11"><a></a>$$;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Call it with:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb9-1"><a></a><span class="kw">CALL</span> delete_customer(<span class="dv">1</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="functions-vs-stored-procedures" class="slide level2">
<h2>Functions vs Stored Procedures</h2>
<div class="line-block">Feature | Function | Stored Procedure |</div>
<p>||-|‚Äì| | Returns | Scalar or table data | No return (output via OUT params) | | Used in SQL | Yes (can be called in queries) | No (must use <code>CALL</code>) | | Transaction Control | No | Yes (can use COMMIT/ROLLBACK) | | Ideal Use Case | Computation, data transformation | Batch jobs, transactional workflows |</p>
<h3 id="when-to-use-which">When to Use Which?</h3>
<ul>
<li>Use <strong>functions</strong> when you need return values or reusable logic inside queries.</li>
<li>Use <strong>procedures</strong> for complex tasks that modify many rows, interact with multiple tables, or require transaction control.</li>
</ul>
</section>
<section id="triggers-in-postgresql" class="slide level2">
<h2>Triggers in PostgreSQL</h2>
<p>A <strong>trigger</strong> runs a function automatically when a specified event occurs on a table.</p>
<h3 id="events">Events:</h3>
<ul>
<li><code>BEFORE</code> or <code>AFTER</code></li>
<li><code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, or <code>TRUNCATE</code></li>
</ul>
</section>
<section id="trigger-example-log-customer-deletion" class="slide level2">
<h2>Trigger Example: Log Customer Deletion</h2>
<h3 id="step-1-create-log-table-if-you-havent-already">Step 1: Create Log Table (if you haven‚Äôt already)</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb10-1"><a></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> customer_deletion_log (</span>
<span id="cb10-2"><a></a>  customer_id <span class="dt">INT</span>,</span>
<span id="cb10-3"><a></a>  deleted_at <span class="dt">TIMESTAMP</span> <span class="kw">DEFAULT</span> NOW()</span>
<span id="cb10-4"><a></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-trigger" class="slide level2">
<h2>Create Trigger</h2>
<h3 id="step-2-create-trigger-function">Step 2: Create Trigger Function</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb11-1"><a></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">FUNCTION</span> log_customer_deletion()</span>
<span id="cb11-2"><a></a>RETURNS <span class="kw">TRIGGER</span> <span class="kw">AS</span> $$</span>
<span id="cb11-3"><a></a><span class="cf">BEGIN</span></span>
<span id="cb11-4"><a></a>  <span class="kw">INSERT</span> <span class="kw">INTO</span> customer_deletion_log(customer_id, deleted_at)</span>
<span id="cb11-5"><a></a>  <span class="kw">VALUES</span> (<span class="kw">OLD</span>.customer_id, NOW());</span>
<span id="cb11-6"><a></a>  <span class="kw">RETURN</span> <span class="kw">OLD</span>;</span>
<span id="cb11-7"><a></a><span class="cf">END</span>;</span>
<span id="cb11-8"><a></a>$$ LANGUAGE plpgsql;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-trigger-1" class="slide level2">
<h2>Create Trigger</h2>
<h3 id="step-3-attach-trigger-to-customer-table">Step 3: Attach Trigger to <code>customer</code> Table</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a></a><span class="kw">CREATE</span> <span class="kw">TRIGGER</span> trg_log_customer_delete</span>
<span id="cb12-2"><a></a><span class="kw">AFTER</span> <span class="kw">DELETE</span> <span class="kw">ON</span> customer</span>
<span id="cb12-3"><a></a><span class="cf">FOR</span> <span class="kw">EACH</span> <span class="kw">ROW</span></span>
<span id="cb12-4"><a></a><span class="kw">EXECUTE</span> <span class="kw">FUNCTION</span> log_customer_deletion();</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<h3 id="test-it">Test It!</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb13-1"><a></a><span class="kw">DELETE</span> <span class="kw">FROM</span> customer <span class="kw">WHERE</span> customer_id <span class="op">=</span> <span class="dv">1</span>;</span>
<span id="cb13-2"><a></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> customer_deletion_log;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="summary" class="slide level2">
<h2>Summary</h2>
<ul>
<li><strong>Views</strong>: Encapsulate reusable queries</li>
<li><strong>Functions</strong>: Reusable logic that can return scalar/table data</li>
<li><strong>Procedures</strong>: Logic with transaction control, no return value</li>
<li><strong>Triggers</strong>: Automatically invoke logic on data events (e.g., inserts/deletes)</li>
</ul>
</section>
<section class="slide level2">

</section></section>
<section id="prerequisites" class="title-slide slide level1 center">
<h1>üî≠ Prerequisites</h1>
<ol type="1">
<li>A Railway PostgreSQL database instance.</li>
<li>A <code>.csv</code> file to import (e.g., <code>data.csv</code>).</li>
<li><code>psql</code> command-line tool installed on your computer.</li>
<li>A table in your PostgreSQL database to import the data into exists and contains the same columns as the CSV file. You may wish to eliminate any columns that you will not use.</li>
</ol>
</section>

<section>
<section id="verifying-you-can-run-the-psql-command" class="title-slide slide level1 center">
<h1>üîç Verifying You Can Run the <code>psql</code> Command</h1>

</section>
<section id="windows-verifying-you-can-run-the-psql-command" class="slide level2">
<h2>Windows: Verifying You Can Run the <code>psql</code> Command</h2>
<ol type="1">
<li><p>Go to a command prompt (cmd) or PowerShell and try to run:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a></a><span class="ex">psql</span> <span class="at">--version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If it returns a version, you‚Äôre good to go!</p></li>
<li><p>If the command fails, try these steps:</p></li>
</ol>
<ul>
<li>Open Windows Explorer and navigate to your PostgreSQL installation directory. This is usually in <code>C:\Program Files\PostgreSQL\&lt;version&gt;\bin</code>.
<ul>
<li>Look for <code>psql.exe</code> in the <code>bin</code> folder.</li>
</ul></li>
</ul>
</section>
<section id="windows-adding-postgresql-to-path" class="slide level2">
<h2>Windows: Adding PostgreSQL to PATH</h2>
<ol start="3" type="1">
<li><p>If you find it, add the path to your system‚Äôs PATH variable:</p>
<pre><code> - In the Start menu, type in **Environment Variables** and click it.
 - Click on **Environment Variables**.
 - Under **System Variables**, find `Path`, click **Edit**.
 - Click **New** and add the path to the `bin` folder.
 - Click **OK** to close all dialog boxes.
 - Restart your command prompt or PowerShell to apply changes.</code></pre></li>
<li><p>Try running <code>psql --version</code> again and ensure it returns a version number.</p></li>
</ol>
</section>
<section id="mac-verifying-you-can-run-the-psql-command" class="slide level2">
<h2>Mac: Verifying You Can Run the <code>psql</code> Command</h2>
<ol type="1">
<li><p>Open a terminal and run:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a></a><span class="ex">psql</span> <span class="at">--version</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If it returns a version, you‚Äôre good to go!</p></li>
<li><p>If the command fails, try these steps:</p>
<ul>
<li>Alternative 1 (using brew): 1 Open a terminal and run: <code>bash      brew install postgresql</code> 2 After installation, run: <code>bash      brew services start postgresql</code> 3 Try running <code>psql --version</code> again and ensure it returns a version number.</li>
</ul></li>
</ol>
</section>
<section id="mac-verifying-you-can-run-the-psql-command-alt" class="slide level2">
<h2>Mac: Verifying You Can Run the <code>psql</code> Command Alt</h2>
<ol type="1">
<li><p>Locate your PostgreSQL installation directory. This is usually in <code>/Library/PostgreSQL/&lt;version&gt;/bin</code>.</p></li>
<li><p>Open your terminal and run:</p></li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a></a><span class="bu">export</span> <span class="va">PATH</span><span class="op">=</span><span class="st">"/Library/PostgreSQL/&lt;version&gt;/bin:</span><span class="va">$PATH</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>To make this change permanent:
<ul>
<li>Open your terminal and run (be sure to replace <code>&lt;version&gt;</code> with your installed version):</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a></a><span class="bu">echo</span> <span class="st">'export PATH="/Library/PostgreSQL/&lt;version&gt;/bin:$PATH"'</span> <span class="op">&gt;&gt;</span> ~/.bash_profile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then run:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a></a><span class="bu">source</span> ~/.bash_profile</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li>Try running <code>psql --version</code> again and ensure it returns a version number.</li>
</ol>
</section></section>
<section id="get-the-railway-postgres-connection-url" class="title-slide slide level1 center">
<h1>üåê Get the Railway Postgres Connection URL</h1>
<ol type="1">
<li>Go to your Railway project</li>
<li>Navigate to your PostgreSQL service</li>
<li>Copy the <code>DATABASE_PUBLIC_URL</code> from the <strong>Connect</strong> tab</li>
</ol>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>üö® This URL contains your password, handle it with care.</p>
</div>
</div>
</div>
</section>

<section>
<section id="copying-csv-file-using-psql" class="title-slide slide level1 center">
<h1>üì¶ Copying CSV File Using <code>psql</code></h1>

</section>
<section id="copying-csv-file-using-psql-on-windows" class="slide level2">
<h2>Copying CSV File Using <code>psql</code> on Windows</h2>
<ol type="1">
<li>In your command prompt (cmd) or PowerShell, navigate to the directory where your <code>.csv</code> file is located (i.e.&nbsp;<code>cd ~\\Documents\\</code>.).</li>
<li>Run the following command:</li>
</ol>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a></a><span class="ex">psql</span> postgresql://postgres:<span class="op">&lt;</span>password<span class="op">&gt;</span>@<span class="op">&lt;</span>host<span class="op">&gt;</span>:<span class="op">&lt;</span>port<span class="op">&gt;</span>/<span class="op">&lt;</span>dbname<span class="op">&gt;</span> -c <span class="st">"\copy tablename FROM 'data.csv' WITH CSV HEADER"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>If successful, the command prints a success message indicating the number of rows imported.</li>
</ol>
</section>
<section id="copying-csv-file-using-psql-on-mac" class="slide level2">
<h2>Copying CSV File Using <code>psql</code> on Mac</h2>
<ol type="1">
<li>In your terminal, navigate to the directory where your <code>.csv</code> file is located (i.e.&nbsp;<code>cd ~/Documents/</code>).</li>
<li>Run the following command:</li>
</ol>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a></a><span class="ex">psql</span> postgresql://postgres:<span class="op">&lt;</span>password<span class="op">&gt;</span>@<span class="op">&lt;</span>host<span class="op">&gt;</span>:<span class="op">&lt;</span>port<span class="op">&gt;</span>/<span class="op">&lt;</span>dbname<span class="op">&gt;</span> -c <span class="st">"\copy books FROM 'data.csv' WITH CSV HEADER"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>If successful, the command prints a success message indicating the number of rows imported.</li>
</ol>
</section></section>
<section id="tips-and-troubleshooting" class="title-slide slide level1 center">
<h1>üíÅüèΩ Tips and Troubleshooting</h1>
<ul>
<li>Ensure your <code>.csv</code> file is in the same directory you‚Äôre running <code>psql</code> from or use an absolute path.</li>
<li>Use double backslashes (<code>\</code>) on Windows for file paths.</li>
<li>Check for table permissions if the import fails.</li>
</ul>
</section>

<section>
<section id="verify" class="title-slide slide level1 center">
<h1>üëÄ Verify</h1>
<p>To verify the data was imported:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb22-1"><a></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> tablename <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="outline" class="title-slide slide level1 center">
<h1>Outline</h1>
<ul>
<li>Measuring Query Time (Benchmarking)</li>
<li>Understanding Indexing</li>
<li>Examples Using the Pagila Database</li>
<li>Hands-on Activities</li>
</ul>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="what-is-query-performance" class="title-slide slide level1 center">
<h1>What is Query Performance?</h1>
<ul>
<li>How fast a database can return the result of a query</li>
<li>Critical for large-scale applications and responsive systems</li>
<li>Affected by schema design, indexing, hardware, and query structure</li>
</ul>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="benchmarking-queries" class="title-slide slide level1 center">
<h1>Benchmarking Queries</h1>

</section>
<section id="method-1-explain-analyze" class="slide level2">
<h2>Method 1: <code>EXPLAIN ANALYZE</code></h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb23-1"><a></a><span class="kw">EXPLAIN</span> <span class="kw">ANALYZE</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> film <span class="kw">WHERE</span> title <span class="op">=</span> <span class="st">'ACADEMY DINOSAUR'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Shows the query plan and actual execution time</li>
<li>Helps diagnose performance bottlenecks</li>
</ul>
</section>
<section id="method-2-iming-in-psql" class="slide level2">
<h2>Method 2: <code>iming</code> in psql</h2>
<p>Enable timing:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb24-1"><a></a>\timing</span>
<span id="cb24-2"><a></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> film <span class="kw">WHERE</span> title <span class="op">=</span> <span class="st">'ACADEMY DINOSAUR'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="pagila-database" class="title-slide slide level1 center">
<h1>Pagila Database</h1>
<ul>
<li>We‚Äôll be using the Pagila database for our examples</li>
<li>Contains tables like <code>customer</code>, <code>film</code>, <code>rental</code>, etc.</li>
<li>Ideal for practicing query performance and indexing.</li>
</ul>
</section>
<section id="sample-query-to-benchmark" class="slide level2">
<h2>Sample Query to Benchmark</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb25-1"><a></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> customer <span class="kw">WHERE</span> last_name <span class="op">=</span> <span class="st">'SMITH'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let‚Äôs try with and without indexing to observe time difference.</p>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="indexing-in-postgresql" class="title-slide slide level1 center">
<h1>Indexing in PostgreSQL</h1>
<ul>
<li>Improves data lookup speed</li>
<li>Common types: B-tree (default), Hash, GIN, GiST</li>
</ul>
</section>
<section id="create-an-index" class="slide level2">
<h2>Create an Index</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb26-1"><a></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_customer_last_name <span class="kw">ON</span> customer(last_name);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then re-run:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb27-1"><a></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> customer <span class="kw">WHERE</span> last_name <span class="op">=</span> <span class="st">'SMITH'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="remove-the-index" class="slide level2">
<h2>Remove the Index</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb28-1"><a></a><span class="kw">DROP</span> <span class="kw">INDEX</span> idx_customer_last_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Compare the performance with and without the index.</p>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="visualizing-the-query-plan" class="title-slide slide level1 center">
<h1>Visualizing the Query Plan</h1>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb29-1"><a></a><span class="kw">EXPLAIN</span> (<span class="kw">ANALYZE</span>, VERBOSE, BUFFERS)</span>
<span id="cb29-2"><a></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> customer <span class="kw">WHERE</span> last_name <span class="op">=</span> <span class="st">'SMITH'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Pay attention to:
<ul>
<li>Seq Scan vs Index Scan</li>
<li>Cost</li>
<li>Actual Time</li>
<li>Rows</li>
</ul></li>
</ul>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="when-indexes-help" class="title-slide slide level1 center">
<h1>When Indexes Help</h1>
<ul>
<li>WHERE conditions on indexed columns</li>
<li>JOIN operations using indexed keys</li>
<li>ORDER BY clauses on indexed columns</li>
</ul>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="when-indexes-hurt" class="title-slide slide level1 center">
<h1>When Indexes Hurt</h1>
<ul>
<li>Insert/Update operations (due to overhead)</li>
<li>Low cardinality columns (e.g., gender)</li>
<li>Queries that return large portions of the table</li>
</ul>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="bonus-composite-indexes" class="title-slide slide level1 center">
<h1>Bonus: Composite Indexes</h1>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb30-1"><a></a><span class="kw">CREATE</span> <span class="kw">INDEX</span> idx_payment_customer_date</span>
<span id="cb30-2"><a></a><span class="kw">ON</span> payment (customer_id, payment_date);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Try filtering by both fields in WHERE clause to observe impact.</p>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="hands-on-challenge" class="title-slide slide level1 center">
<h1>Hands-On Challenge</h1>
<ol type="1">
<li>Use Pagila DB</li>
<li>Benchmark a query on <code>rental</code>, <code>inventory</code>, or <code>film_actor</code></li>
<li>Create and test different indexes</li>
<li>Record query times and plan output</li>
</ol>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="summary-1" class="title-slide slide level1 center">
<h1>Summary</h1>
<ul>
<li>Use <code>EXPLAIN ANALYZE</code> and <code>\timing</code> to measure performance</li>
<li>Indexing is powerful but must be used thoughtfully</li>
<li>Practice is key ‚Äî use Pagila to explore real-world patterns</li>
</ul>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="questions" class="title-slide slide level1 center">
<h1>Questions?</h1>
<p>Let‚Äôs practice benchmarking with Pagila!</p>
</section>
<section class="slide level2">

</section></section>
<section>
<section id="introduction-to-data-mining-with-postgres" class="title-slide slide level1 center">
<h1>Introduction to Data Mining with Postgres</h1>
<ul>
<li>PostgreSQL provides powerful tools for querying, cleaning, and extracting insights from structured data.</li>
<li>The <code>Pagila</code> sample database, based on the classic DVD rental business, is ideal for practicing these skills.</li>
</ul>
</section>
<section id="what-is-data-mining" class="slide level2">
<h2>What is Data Mining?</h2>
<ul>
<li>The process of discovering patterns in large datasets</li>
<li>Involves techniques from:
<ul>
<li>Statistics</li>
<li>Machine Learning</li>
<li>Pattern Recognition</li>
</ul></li>
<li>PostgreSQL provides extensible SQL querying capabilities perfect for early-stage data mining</li>
</ul>
</section>
<section id="the-pagila-database" class="slide level2">
<h2>The Pagila Database</h2>
<ul>
<li>Inspired by the Sakila database from MySQL</li>
<li>Contains:
<ul>
<li>Films, actors, and categories</li>
<li>Rentals and payments</li>
<li>Customers and their demographics</li>
</ul></li>
</ul>
</section>
<section id="regular-expressions-in-postgresql" class="slide level2">
<h2>Regular Expressions in PostgreSQL</h2>
<ul>
<li><code>~</code> : match regex<br>
</li>
<li><code>~*</code> : match case-insensitive<br>
</li>
<li><code>!~</code> : does not match regex<br>
</li>
<li><code>!~*</code> : does not match case-insensitive</li>
</ul>
</section>
<section id="examples" class="slide level2">
<h2>Examples</h2>
</section></section>
<section>
<section id="find-all-customers-whose-last-name-starts-with-mc" class="title-slide slide level1 center">
<h1>Find all customers whose last name starts with ‚ÄòMc‚Äô</h1>
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb31-1"><a></a><span class="kw">SELECT</span> first_name, last_name</span>
<span id="cb31-2"><a></a><span class="kw">FROM</span> customer</span>
<span id="cb31-3"><a></a><span class="kw">WHERE</span> last_name ~ <span class="st">'^Mc'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="case-insensitive-matching" class="slide level2">
<h2>Case-Insensitive Matching</h2>
</section></section>
<section id="find-film-titles-that-include-the-word-love-case-insensitive" class="title-slide slide level1 center">
<h1>Find film titles that include the word ‚Äòlove‚Äô (case-insensitive)</h1>
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb32-1"><a></a><span class="kw">SELECT</span> title</span>
<span id="cb32-2"><a></a><span class="kw">FROM</span> film</span>
<span id="cb32-3"><a></a><span class="kw">WHERE</span> title ~<span class="op">*</span> <span class="st">'love'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>

<section>
<section id="using-regex-to-classify-films" class="title-slide slide level1 center">
<h1>Using Regex to Classify Films</h1>

</section>
<h3 id="tag-films-that-contain-numbers-in-the-title">Tag films that contain numbers in the title</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb33-1"><a></a><span class="kw">SELECT</span> title</span>
<span id="cb33-2"><a></a><span class="kw">FROM</span> film</span>
<span id="cb33-3"><a></a><span class="kw">WHERE</span> title ~ <span class="st">'</span><span class="ch">\\</span><span class="st">d'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>\\d</code> matches any digit (requires double backslash in SQL)</li>
</ul></section>
<section id="extracting-words-regex-functions" class="title-slide slide level1 center">
<h1>Extracting Words: Regex Functions</h1>
<ul>
<li><code>substring(string from pattern)</code></li>
<li><code>regexp_replace(string, pattern, replacement)</code></li>
<li><code>regexp_matches(string, pattern)</code></li>
</ul>
</section>

<section id="example-extract-the-first-word-from-film-titles" class="title-slide slide level1 center">
<h1>Example: Extract the first word from film titles</h1>
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb34-1"><a></a><span class="kw">SELECT</span> title, substring(title <span class="kw">FROM</span> <span class="st">'^</span><span class="ch">\\</span><span class="st">w+'</span>) <span class="kw">AS</span> first_word</span>
<span id="cb34-2"><a></a><span class="kw">FROM</span> film</span>
<span id="cb34-3"><a></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>

<section id="regex-replace-clean-up-phone-numbers" class="title-slide slide level1 center">
<h1>Regex Replace: Clean Up Phone Numbers</h1>
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb35-1"><a></a><span class="kw">SELECT</span> phone,</span>
<span id="cb35-2"><a></a>       <span class="fu">regexp_replace</span>(phone, <span class="st">'[^</span><span class="ch">\\</span><span class="st">d]'</span>, <span class="st">''</span>, <span class="st">'g'</span>) <span class="kw">AS</span> digits_only</span>
<span id="cb35-3"><a></a><span class="kw">FROM</span> address</span>
<span id="cb35-4"><a></a><span class="kw">LIMIT</span> <span class="dv">5</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>

<section>
<section id="advanced-query-categorize-titles-by-pattern" class="title-slide slide level1 center">
<h1>Advanced Query: Categorize Titles by Pattern</h1>

</section>
<section id="group-films-by-those-containing-love-vs-not" class="slide level2">
<h2>Group films by those containing ‚Äòlove‚Äô vs not</h2>
<div class="sourceCode" id="cb36"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb36-1"><a></a><span class="kw">SELECT</span></span>
<span id="cb36-2"><a></a>  <span class="cf">CASE</span> <span class="cf">WHEN</span> title ~<span class="op">*</span> <span class="st">'love'</span> <span class="cf">THEN</span> <span class="st">'Contains Love'</span></span>
<span id="cb36-3"><a></a>       <span class="cf">ELSE</span> <span class="st">'Does Not Contain Love'</span> <span class="cf">END</span> <span class="kw">AS</span> love_category,</span>
<span id="cb36-4"><a></a>  <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> film_count</span>
<span id="cb36-5"><a></a><span class="kw">FROM</span> film</span>
<span id="cb36-6"><a></a><span class="kw">GROUP</span> <span class="kw">BY</span> <span class="dv">1</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section></section>
<section>
<section id="use-regex-in-joins" class="title-slide slide level1 center">
<h1>Use Regex in Joins</h1>

</section>
<h3 id="find-all-customers-whose-email-domain-is-yahoo.com">Find all customers whose email domain is yahoo.com</h3>
<div class="sourceCode" id="cb37"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb37-1"><a></a><span class="kw">SELECT</span> first_name, last_name, email</span>
<span id="cb37-2"><a></a><span class="kw">FROM</span> customer</span>
<span id="cb37-3"><a></a><span class="kw">WHERE</span> email ~<span class="op">*</span> <span class="st">'@yahoo</span><span class="ch">\\</span><span class="st">.com$'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></section>
<section id="practice-challenge" class="title-slide slide level1 center">
<h1>Practice Challenge</h1>
<p>Write a query that finds all films where the title:</p>
<ul>
<li>Ends with a number</li>
<li>Contains the word ‚ÄúAdventure‚Äù anywhere</li>
<li>Is over 100 minutes long</li>
</ul>
<p><em>Tip: Use <code>~</code>, <code>AND</code>, and <code>length</code> fields</em></p>
</section>

<section id="tips-and-tricks" class="title-slide slide level1 center">
<h1>Tips and Tricks</h1>
<ul>
<li>Always escape backslashes in regex</li>
<li>Use <code>EXPLAIN</code> to monitor performance</li>
<li>Test expressions in small queries first</li>
</ul>
</section>

<section id="resources" class="title-slide slide level1 center">
<h1>Resources</h1>
<ul>
<li>PostgreSQL Regex Docs: https://www.postgresql.org/docs/current/functions-matching.html</li>
<li>Regex101 Testing: https://regex101.com/</li>
<li>Pagila DB: https://github.com/devrimgunduz/pagila</li>
</ul>
</section>

<section id="questions-1" class="title-slide slide level1 center">
<h1>Questions?</h1>
<p>Use the Pagila database to experiment with regex in real-world data mining!</p>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/LucasCordova\.github\.io\/DataEngineering\/");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>